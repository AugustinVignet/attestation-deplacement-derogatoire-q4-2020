steps:
  # Npm install all the dependencies
  - id: npm-install
    name: 'gcr.io/cloud-builders/npm'
    args: ['install']
    waitFor: ['-']

  # Npm build
  - id: npm-build
    name: 'gcr.io/cloud-builders/npm'
    args: ['myBuild']
    waitFor: ['-']

  # Deploy to cloud function
  - id: deploy-to-cloud-function
    name: 'gcr.io/cloud-builders/gcloud'
    args:
      [
        'functions',
        'deploy',
        'covidGus',
        '--entry-point=covidGus',
        '--runtime=nodejs10',
        '--trigger-http',
        '--allow-unauthenticated',
      ]
    waitFor: ['npm-install']
timeout: '1600s'
